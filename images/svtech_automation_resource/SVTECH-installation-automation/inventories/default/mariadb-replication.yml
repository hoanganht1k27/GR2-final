all:
  children:
    single:
    galera_cluster:
    replication:
      children:
        replication_master:
          hosts:
            db-01:
              ansible_host: 10.98.10.172
              IP: 10.98.10.172
              server_id: 1
        replication_slave:
          hosts:
            db-02:
              ansible_host: 10.98.10.173
              IP: 10.98.10.173
              server_id: 2
            db-03:
              ansible_host: 10.98.10.174
              IP: 10.98.10.174
              server_id: 3  
          vars:
            Is_Slave: true
            backup_dir: /tmp/mariabackup
      vars:
        gtid_domain: 1    
        replication_user:
          name: "repl_user"
          host: "%"
          password: "repl_user@123"
          priv: "*.*:REPLICATION SLAVE,REPLICATION CLIENT"

    maxscale:
      hosts:
        db-01:
          ansible_host: 10.98.10.172
          IP: 10.98.10.172
        db-02:
          ansible_host: 10.98.10.173
          IP: 10.98.10.173
        db-03:
          ansible_host: 10.98.10.174
          IP: 10.98.10.174
      vars:
        # Maxscale Global attributes
        admin_host: "0.0.0.0"
        admin_secure_gui: "true"
        maxscale_datadir: "/var/lib/maxscale"
        maxscale_admin_user: "juniper"
        maxscale_admin_password: "juniper@123"
        maxscale_ca_cert: "ca-cert.pem"
        maxscale_key: "server-key.pem"
        maxscale_csr: "server-req.pem"
        maxscale_cert: "server-cert.pem"
        # Maxscale monitor attributes
        monitor_interval: 1000
        auto_failover: "true"
        auto_rejoin: "true"
        enforce_read_only_slaves: "on"
        enforce_writable_master: "on"
        cooperative_monitoring_locks: "majority_of_running"
        master_conditions: "primary_monitor_master,connected_slave,running_slave"
        slave_conditions: "primary_monitor_master,linked_master,writable_master"
        failcount: 3
        # Maxscal Read-Write-Split service attributes      
        master_accept_reads: "true"
        master_failure_mode: "error_on_write"
        master_reconnection: "true"
        maxscale_read_write_port: "4006"
        # Maxscale binlog service attributes
        select_master: "true"
        server_id: "999"
        expire_log_duration: "5h"
        expire_log_minimum_files: "3"
        binlog_dir: "/var/lib/maxscale/binlogs"
        maxscale_bin_log_port: "3307"
        # Login to Mariadb console and create maxscale user (CHECK VALID USER FROM CLIENT ONLY)
        maxscale_user:
          name: "maxscale"
          password: "maxscale@123"
          host:
            - localhost
          priv:
            'mysql.user': 'SELECT'
            'mysql.db': 'SELECT'
            'mysql.tables_priv': 'SELECT'
            'mysql.columns_priv': 'SELECT'
            'mysql.proxies_priv': 'SELECT'
            'mysql.roles_mapping': 'SELECT'
            'mysql.procs_priv': 'SELECT'
            '*.*': 'SHOW DATABASES,REPLICATION SLAVE,REPLICATION CLIENT'
        monitor_user:
          name: "maxscale_monitor"
          password: "maxscale@123"
          host:
            - localhost
          priv:
            '*.*': 'FILE,REPLICATION SLAVE,REPLICATION CLIENT,SUPER,RELOAD'

  vars:
    prefix: "production"
    ansible_ssh_user: "root"
    ansible_ssh_port: 22
    admin_user: "juniper"
    admin_password: "juniper@123"
    timezone: "Asia/Ho_Chi_Minh"
    install_python3: "true"
    upgrade_pip: "true"

    ### MariaDB Variables ###
    mariadb_version: "10.5"
    auto_gen_password: "false"
    mariadb_root_password: "juniper@123"
    mariadb_port: 3306
    innodb_buffer_pool_size_percent: 50
    data_dir: /var/lib/mysql

