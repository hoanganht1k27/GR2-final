#
# These groups are read by MariaDB server.
# Use it for options that only the server (but not clients) should see
#
# See the examples of server my.cnf files in /usr/share/mysql/
#

# this is read by the standalone daemon and embedded servers
[server]

# this is only for the mysqld standalone daemon
[mysqld]
# GENERAL #
port 				= {{ mariadb_port }}
basedir 			= /usr
datadir 			= /var/lib/mysql
tmpdir 				= /tmp
server-id                       = {{ hostvars[inventory_hostname].server_id }}
gtid-domain-id                  = 1
character-set-server            = utf8
collation-server                = utf8_general_ci
default-storage-engine          = innodb
log-bin                         = binlog
log_slave_updates               = 1
binlog-format                   = ROW
expire-logs-days                = 2
skip-name-resolve
lower_case_table_names          = 1
max_connections                 = 15000
performance_schema 		= ON

# THREADS #
#thread_handling 		= pool-of-threads
thread_pool_size 		= 16
#thread-cache-size 		= 250
thread_cache_size               = 160
#thread_concurrency              = 32

# INNODB #
innodb_buffer_pool_instances	= 2
innodb_buffer_pool_size         = 2512M
innodb_log_file_size            = 256M
innodb_log_files_in_group	= 2
innodb_log_buffer_size          = 8M
innodb_flush_method             = O_DIRECT
innodb_flush_log_at_trx_commit  = 0
innodb_lock_wait_timeout        = 5
innodb_file_per_table		= ON

# SAFETY #
max-allowed-packet 		= 64M
max-connect-errors 		= 1000000
	
# CACHES AND LIMITS #
tmp_table_size                  = 512M
max_heap_table_size             = 512M
query_cache_limit               = 96M
query_cache_size                = 256M
query_cache_type 		= 1
table_open_cache                = 400
table-definition-cache 		= 4096

sort_buffer_size                = 32M
join_buffer_size                = 256M
#read_rnd_buffer_size            = 2M
read_buffer_size                = 32M
myisam_sort_buffer_size         = 32M
interactive_timeout             = 180
wait_timeout                    = 180

#Slow log
slow_query_log                  = 1
slow_query_log_file             = /var/log/mysql/slow.log
log-error                       = /var/log/mysql/error.log
long_query_time                 = 10

#
# * Galera-related settings
#
[galera]
wsrep_on                        = on
wsrep_provider                  = /usr/lib64/galera/libgalera_smm.so
wsrep_provider_options          = "gcache.size=1G"
#wsrep_cluster_address           = "gcomm://{{ hostvars[inventory_hostname].node1_ip }},{{ hostvars[inventory_hostname].node2_ip }},{{ hostvars[inventory_hostname].node3_ip }}"
wsrep_cluster_address           = "gcomm://{% for host in groups['all'] %}{{hostvars[host].IP}}{% if not loop.last %},{% endif %}{% endfor %}"
wsrep_cluster_name              = '{{ hostvars[inventory_hostname].wsrep_cluster_name }}'
wsrep_node_address              = '{{ hostvars[inventory_hostname].IP }}'
wsrep_node_name                 = '{{ inventory_hostname }}'
wsrep_sst_method 		= mariabackup
wsrep_sst_auth                  = {{ hostvars[inventory_hostname].wsrep_sst_auth_user }}:{{ hostvars[inventory_hostname].wsrep_sst_auth_password }}

innodb_autoinc_lock_mode        = 2
wsrep_slave_threads             = 2
sync_binlog                     = 1

# this is only for embedded server
[embedded]

# This group is only read by MariaDB servers, not by MySQL.
# If you use the same .cnf file for MySQL and MariaDB,
# you can put MariaDB-only options here
[mariadb]

# This group is only read by MariaDB-10.1 servers.
# If you use the same .cnf file for MariaDB of different versions,
# use this group for options that older servers don't understand
[mariadb-10.1]


